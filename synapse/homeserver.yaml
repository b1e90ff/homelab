# Konfigurationsdatei für Dendrite
#
# Dies ist eine YAML-Datei: siehe [1] für eine kurze Einführung. Beachten Sie insbesondere,
# dass *Einrückungen wichtig sind*: alle Elemente einer Liste oder eines Wörterbuchs
# sollten die gleiche Einrückung haben.
#
# [1] https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html
#
# Weitere Informationen zur Konfiguration von Dendrite finden Sie unter
# https://github.com/matrix-org/dendrite/blob/main/docs/dendrite.yaml
global:
  server_name: "matrix.tat.systems"
  private_key: /data/matrix.tat.systems.key
  trusted_key_servers:
    - server_name: "matrix.org"
      key_validity_period: 24h
  database:
    connection_string: "postgres://synapse_user:${SECRET_SYNAPSE_POSTGRES_PASSWORD}@synapse-db/synapse?sslmode=disable"
  media:
    base_path: /data/media_store
  registration:
    enabled: true
    shared_secret: "${SECRET_SYNAPSE_REGISTRATION_SHARED_SECRET}"
  turn:
    turn_uris: ["turn:turn.tat.systems:3478?transport=udp", "turn:turn.tat.systems:3478?transport=tcp"]
    shared_secret: "${SECRET_SYNAPSE_TURN_SECRET}"
    user_lifetime: "24h"
    allow_guests: true
  email:
    smtp:
      host: smtp.sendgrid.net
      port: 587
      username: "apikey"
      password: "${SECRET_SENDGRID_API_KEY}"
      require_tls: true
    from: "<noreply@tat.systems>"
    app_name: TatSystems
  logging:
    level: info
    format: text
    path: /data/matrix.tat.systems.log

client_api:
  listen: "0.0.0.0:8008"
  registration_disabled: false
  registration_shared_secret: "${SECRET_SYNAPSE_REGISTRATION_SHARED_SECRET}"
  allow_guest_access: true
  enable_registration_without_verification: true

federation_api:
  listen: "0.0.0.0:8448"

media_api:
  listen: "0.0.0.0:8008"

sync_api:
  listen: "0.0.0.0:8008"

key_server:
  listen: "0.0.0.0:8008"

room_server:
  listen: "0.0.0.0:8008"

user_api:
  listen: "0.0.0.0:8008"
  oidc:
    enabled: true
    providers:
      - idp_id: zitadel
        idp_name: Synapse
        issuer: "https://auth.tat.systems"
        client_id: "${SECRET_SYNAPSE_ZITADEL_CLIENT_ID}"
        client_secret: "${SECRET_SYNAPSE_ZITADEL_CLIENT_SECRET}"
        scopes: ["openid", "profile", "email"]
        authorization_endpoint: "https://auth.tat.systems/oauth/v2/authorize"
        token_endpoint: "https://auth.tat.systems/oauth/v2/token"
        userinfo_endpoint: "https://auth.tat.systems/oidc/v1/userinfo"
        user_mapping:
          display_name: "name"
          email: "email"
          avatar_url: "picture"
          admin_roles: ["Admin"]
